"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipeline = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const path = require("path");
const cb = require("@aws-cdk/aws-codebuild");
const cp = require("@aws-cdk/aws-codepipeline");
const cpa = require("@aws-cdk/aws-codepipeline-actions");
const iam = require("@aws-cdk/aws-iam");
const core_1 = require("@aws-cdk/core");
const cxapi = require("@aws-cdk/cx-api");
const constructs_1 = require("constructs");
const blueprint_1 = require("../blueprint");
const docker_credentials_1 = require("../docker-credentials");
const helpers_internal_1 = require("../helpers-internal");
const main_1 = require("../main");
const asset_singleton_role_1 = require("../private/asset-singleton-role");
const construct_internals_1 = require("../private/construct-internals");
const fs_1 = require("../private/fs");
const javascript_1 = require("../private/javascript");
const template_configuration_1 = require("../private/template-configuration");
const _codebuild_factory_1 = require("./_codebuild-factory");
const artifact_map_1 = require("./artifact-map");
const codebuild_step_1 = require("./codebuild-step");
/**
 * A CDK Pipeline that uses CodePipeline to deploy CDK apps.
 *
 * This is a `Pipeline` with its `engine` property set to
 * `CodePipelineEngine`, and exists for nicer ergonomics for
 * users that don't need to switch out engines.
 *
 * @stability stable
 */
class CodePipeline extends main_1.PipelineBase {
    /**
     * @stability stable
     */
    constructor(scope, id, props) {
        var _b, _c, _d;
        super(scope, id, props);
        this.props = props;
        this.artifacts = new artifact_map_1.ArtifactMap();
        /**
         * Asset roles shared for publishing
         */
        this.assetCodeBuildRoles = {};
        /**
         * Per asset type, the target role ARNs that need to be assumed
         */
        this.assetPublishingRoles = {};
        this.selfMutation = (_b = props.selfMutation) !== null && _b !== void 0 ? _b : true;
        this.dockerCredentials = (_c = props.dockerCredentials) !== null && _c !== void 0 ? _c : [];
        this.singlePublisherPerAssetType = !((_d = props.publishAssetsInParallel) !== null && _d !== void 0 ? _d : true);
    }
    /**
     * The CodeBuild project that performs the Synth.
     *
     * Only available after the pipeline has been built.
     *
     * @stability stable
     */
    get synthProject() {
        if (!this._synthProject) {
            throw new Error('Call pipeline.buildPipeline() before reading this property');
        }
        return this._synthProject;
    }
    /**
     * The CodePipeline pipeline that deploys the CDK app.
     *
     * Only available after the pipeline has been built.
     *
     * @stability stable
     */
    get pipeline() {
        if (!this._pipeline) {
            throw new Error('Pipeline not created yet');
        }
        return this._pipeline;
    }
    /**
     * Implemented by subclasses to do the actual pipeline construction.
     *
     * @stability stable
     */
    doBuildPipeline() {
        var _b;
        if (this._pipeline) {
            throw new Error('Pipeline already created');
        }
        this._myCxAsmRoot = path.resolve(construct_internals_1.assemblyBuilderOf(construct_internals_1.appOf(this)).outdir);
        if (this.props.codePipeline) {
            if (this.props.pipelineName) {
                throw new Error('Cannot set \'pipelineName\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.crossAccountKeys !== undefined) {
                throw new Error('Cannot set \'crossAccountKeys\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            this._pipeline = this.props.codePipeline;
        }
        else {
            this._pipeline = new cp.Pipeline(this, 'Pipeline', {
                pipelineName: this.props.pipelineName,
                crossAccountKeys: (_b = this.props.crossAccountKeys) !== null && _b !== void 0 ? _b : false,
                // This is necessary to make self-mutation work (deployments are guaranteed
                // to happen only after the builds of the latest pipeline definition).
                restartExecutionOnUpdate: true,
            });
        }
        const graphFromBp = new helpers_internal_1.PipelineGraph(this, {
            selfMutation: this.selfMutation,
            singlePublisherPerAssetType: this.singlePublisherPerAssetType,
        });
        this._cloudAssemblyFileSet = graphFromBp.cloudAssemblyFileSet;
        this.pipelineStagesAndActionsFromGraph(graphFromBp);
    }
    get myCxAsmRoot() {
        if (!this._myCxAsmRoot) {
            throw new Error('Can\'t read \'myCxAsmRoot\' if build deployment not called yet');
        }
        return this._myCxAsmRoot;
    }
    /**
     * Scope for Assets-related resources.
     *
     * Purely exists for construct tree backwards compatibility with legacy pipelines
     */
    get assetsScope() {
        return construct_internals_1.obtainScope(this, 'Assets');
    }
    pipelineStagesAndActionsFromGraph(structure) {
        var _b;
        // Translate graph into Pipeline Stages and Actions
        let beforeSelfMutation = this.selfMutation;
        for (const stageNode of javascript_1.flatten(structure.graph.sortedChildren())) {
            if (!helpers_internal_1.isGraph(stageNode)) {
                throw new Error(`Top-level children must be graphs, got '${stageNode}'`);
            }
            // Group our ordered tranches into blocks of 50.
            // We can map these onto stages without exceeding the capacity of a Stage.
            const chunks = chunkTranches(50, stageNode.sortedLeaves());
            const actionsOverflowStage = chunks.length > 1;
            for (const [i, tranches] of javascript_1.enumerate(chunks)) {
                const stageName = actionsOverflowStage ? `${stageNode.id}.${i + 1}` : stageNode.id;
                const pipelineStage = this.pipeline.addStage({ stageName });
                const sharedParent = new helpers_internal_1.GraphNodeCollection(javascript_1.flatten(tranches)).commonAncestor();
                let runOrder = 1;
                for (const tranche of tranches) {
                    const runOrdersConsumed = [0];
                    for (const node of tranche) {
                        const factory = this.actionFromNode(node);
                        const nodeType = this.nodeTypeFromNode(node);
                        const result = factory.produceAction(pipelineStage, {
                            actionName: actionName(node, sharedParent),
                            runOrder,
                            artifacts: this.artifacts,
                            scope: construct_internals_1.obtainScope(this.pipeline, stageName),
                            fallbackArtifact: this._fallbackArtifact,
                            pipeline: this,
                            // If this step happens to produce a CodeBuild job, set the default options
                            codeBuildDefaults: nodeType ? this.codeBuildDefaultsFor(nodeType) : undefined,
                            beforeSelfMutation,
                        });
                        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'self-update') {
                            beforeSelfMutation = false;
                        }
                        this.postProcessNode(node, result);
                        runOrdersConsumed.push(result.runOrdersConsumed);
                    }
                    runOrder += Math.max(...runOrdersConsumed);
                }
            }
        }
    }
    /**
     * Do additional things after the action got added to the pipeline
     *
     * Some minor state manipulation of CodeBuild projects and pipeline
     * artifacts.
     */
    postProcessNode(node, result) {
        var _b, _c, _d;
        const nodeType = this.nodeTypeFromNode(node);
        if (result.project) {
            const dockerUsage = dockerUsageFromCodeBuild(nodeType !== null && nodeType !== void 0 ? nodeType : CodeBuildProjectType.STEP);
            if (dockerUsage) {
                for (const c of this.dockerCredentials) {
                    c.grantRead(result.project, dockerUsage);
                }
            }
            if (nodeType === CodeBuildProjectType.SYNTH) {
                this._synthProject = result.project;
            }
        }
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step' && ((_c = node.data.step.primaryOutput) === null || _c === void 0 ? void 0 : _c.primaryOutput) && !this._fallbackArtifact) {
            this._fallbackArtifact = this.artifacts.toCodePipeline((_d = node.data.step.primaryOutput) === null || _d === void 0 ? void 0 : _d.primaryOutput);
        }
    }
    /**
     * Make an action from the given node and/or step
     */
    actionFromNode(node) {
        var _b, _c;
        switch ((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) {
            // Nothing for these, they are groupings (shouldn't even have popped up here)
            case 'group':
            case 'stack-group':
            case undefined:
                throw new Error(`actionFromNode: did not expect to get group nodes: ${(_c = node.data) === null || _c === void 0 ? void 0 : _c.type}`);
            case 'self-update':
                return this.selfMutateAction();
            case 'publish-assets':
                return this.publishAssetsAction(node, node.data.assets);
            case 'prepare':
                return this.createChangeSetAction(node.data.stack);
            case 'execute':
                return this.executeChangeSetAction(node.data.stack, node.data.captureOutputs);
            case 'step':
                return this.actionFromStep(node, node.data.step);
        }
    }
    /**
     * Take a Step and turn it into a CodePipeline Action
     *
     * There are only 3 types of Steps we need to support:
     *
     * - Shell (generic)
     * - ManualApproval (generic)
     * - CodePipelineActionFactory (CodePipeline-specific)
     *
     * The rest is expressed in terms of these 3, or in terms of graph nodes
     * which are handled elsewhere.
     */
    actionFromStep(node, step) {
        const nodeType = this.nodeTypeFromNode(node);
        // CodePipeline-specific steps first -- this includes Sources
        if (isCodePipelineActionFactory(step)) {
            return step;
        }
        // Now built-in steps
        if (step instanceof blueprint_1.ShellStep || step instanceof codebuild_step_1.CodeBuildStep) {
            // The 'CdkBuildProject' will be the construct ID of the CodeBuild project, necessary for backwards compat
            let constructId = nodeType === CodeBuildProjectType.SYNTH
                ? 'CdkBuildProject'
                : step.id;
            return step instanceof codebuild_step_1.CodeBuildStep
                ? _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(constructId, step)
                : _codebuild_factory_1.CodeBuildFactory.fromShellStep(constructId, step);
        }
        if (step instanceof blueprint_1.ManualApprovalStep) {
            return {
                produceAction: (stage, options) => {
                    stage.addAction(new cpa.ManualApprovalAction({
                        actionName: options.actionName,
                        runOrder: options.runOrder,
                        additionalInformation: step.comment,
                    }));
                    return { runOrdersConsumed: 1 };
                },
            };
        }
        throw new Error(`Deployment step '${step}' is not supported for CodePipeline-backed pipelines`);
    }
    createChangeSetAction(stack) {
        const changeSetName = 'PipelineChange';
        const templateArtifact = this.artifacts.toCodePipeline(this._cloudAssemblyFileSet);
        const templateConfigurationPath = this.writeTemplateConfiguration(stack);
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        const relativeTemplatePath = path.relative(this.myCxAsmRoot, stack.absoluteTemplatePath);
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationCreateReplaceChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    templatePath: templateArtifact.atPath(fs_1.toPosixPath(relativeTemplatePath)),
                    adminPermissions: true,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    deploymentRole: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.executionRoleArn),
                    region: region,
                    templateConfiguration: templateConfigurationPath
                        ? templateArtifact.atPath(fs_1.toPosixPath(templateConfigurationPath))
                        : undefined,
                    cfnCapabilities: [core_1.CfnCapabilities.NAMED_IAM, core_1.CfnCapabilities.AUTO_EXPAND],
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    executeChangeSetAction(stack, captureOutputs) {
        const changeSetName = 'PipelineChange';
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationExecuteChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    region: region,
                    variablesNamespace: captureOutputs ? _codebuild_factory_1.stackVariableNamespace(stack) : undefined,
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    selfMutateAction() {
        var _b;
        const installSuffix = this.props.cliVersion ? `@${this.props.cliVersion}` : '';
        const pipelineStack = core_1.Stack.of(this.pipeline);
        const pipelineStackIdentifier = (_b = pipelineStack.node.path) !== null && _b !== void 0 ? _b : pipelineStack.stackName;
        const step = new codebuild_step_1.CodeBuildStep('SelfMutate', {
            projectName: javascript_1.maybeSuffix(this.props.pipelineName, '-selfupdate'),
            input: this._cloudAssemblyFileSet,
            installCommands: [
                `npm install -g aws-cdk${installSuffix}`,
            ],
            commands: [
                `cdk -a ${fs_1.toPosixPath(construct_internals_1.embeddedAsmPath(this.pipeline))} deploy ${pipelineStackIdentifier} --require-approval=never --verbose`,
            ],
            rolePolicyStatements: [
                // allow the self-mutating project permissions to assume the bootstrap Action role
                new iam.PolicyStatement({
                    actions: ['sts:AssumeRole'],
                    resources: [`arn:*:iam::${core_1.Stack.of(this.pipeline).account}:role/*`],
                    conditions: {
                        'ForAnyValue:StringEquals': {
                            'iam:ResourceTag/aws-cdk:bootstrap-role': ['image-publishing', 'file-publishing', 'deploy'],
                        },
                    },
                }),
                new iam.PolicyStatement({
                    actions: ['cloudformation:DescribeStacks'],
                    resources: ['*'],
                }),
                // S3 checks for the presence of the ListBucket permission
                new iam.PolicyStatement({
                    actions: ['s3:ListBucket'],
                    resources: ['*'],
                }),
            ],
        });
        // Different on purpose -- id needed for backwards compatible LogicalID
        return _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep('SelfMutation', step, {
            additionalConstructLevel: false,
            scope: construct_internals_1.obtainScope(this, 'UpdatePipeline'),
        });
    }
    publishAssetsAction(node, assets) {
        var _b;
        const installSuffix = this.props.cliVersion ? `@${this.props.cliVersion}` : '';
        const commands = assets.map(asset => {
            const relativeAssetManifestPath = path.relative(this.myCxAsmRoot, asset.assetManifestPath);
            return `cdk-assets --path "${fs_1.toPosixPath(relativeAssetManifestPath)}" --verbose publish "${asset.assetSelector}"`;
        });
        const assetType = assets[0].assetType;
        if (assets.some(a => a.assetType !== assetType)) {
            throw new Error('All assets in a single publishing step must be of the same type');
        }
        const publishingRoles = this.assetPublishingRoles[assetType] = ((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : new Set());
        for (const asset of assets) {
            if (asset.assetPublishingRoleArn) {
                publishingRoles.add(asset.assetPublishingRoleArn);
            }
        }
        const role = this.obtainAssetCodeBuildRole(assets[0].assetType);
        // The base commands that need to be run
        const script = new codebuild_step_1.CodeBuildStep(node.id, {
            commands,
            installCommands: [
                `npm install -g cdk-assets${installSuffix}`,
            ],
            input: this._cloudAssemblyFileSet,
            buildEnvironment: {
                privileged: assets.some(asset => asset.assetType === blueprint_1.AssetType.DOCKER_IMAGE),
            },
            role,
        });
        // Customizations that are not accessible to regular users
        return _codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(node.id, script, {
            additionalConstructLevel: false,
            // If we use a single publisher, pass buildspec via file otherwise it'll
            // grow too big.
            passBuildSpecViaCloudAssembly: this.singlePublisherPerAssetType,
            scope: this.assetsScope,
        });
    }
    nodeTypeFromNode(node) {
        var _b, _c, _d, _e;
        if (((_b = node.data) === null || _b === void 0 ? void 0 : _b.type) === 'step') {
            return !!((_c = node.data) === null || _c === void 0 ? void 0 : _c.isBuildStep) ? CodeBuildProjectType.SYNTH : CodeBuildProjectType.STEP;
        }
        if (((_d = node.data) === null || _d === void 0 ? void 0 : _d.type) === 'publish-assets') {
            return CodeBuildProjectType.ASSETS;
        }
        if (((_e = node.data) === null || _e === void 0 ? void 0 : _e.type) === 'self-update') {
            return CodeBuildProjectType.SELF_MUTATE;
        }
        return undefined;
    }
    codeBuildDefaultsFor(nodeType) {
        const defaultOptions = {
            buildEnvironment: {
                buildImage: cb.LinuxBuildImage.STANDARD_5_0,
                computeType: cb.ComputeType.SMALL,
            },
        };
        const typeBasedCustomizations = {
            [CodeBuildProjectType.SYNTH]: this.props.dockerEnabledForSynth
                ? _codebuild_factory_1.mergeCodeBuildOptions(this.props.synthCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.synthCodeBuildDefaults,
            [CodeBuildProjectType.ASSETS]: this.props.assetPublishingCodeBuildDefaults,
            [CodeBuildProjectType.SELF_MUTATE]: this.props.dockerEnabledForSelfMutation
                ? _codebuild_factory_1.mergeCodeBuildOptions(this.props.selfMutationCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.selfMutationCodeBuildDefaults,
            [CodeBuildProjectType.STEP]: {},
        };
        const dockerUsage = dockerUsageFromCodeBuild(nodeType);
        const dockerCommands = dockerUsage !== undefined
            ? docker_credentials_1.dockerCredentialsInstallCommands(dockerUsage, this.dockerCredentials, 'both')
            : [];
        const typeBasedDockerCommands = dockerCommands.length > 0 ? {
            partialBuildSpec: cb.BuildSpec.fromObject({
                version: '0.2',
                phases: {
                    pre_build: {
                        commands: dockerCommands,
                    },
                },
            }),
        } : {};
        return _codebuild_factory_1.mergeCodeBuildOptions(defaultOptions, this.props.codeBuildDefaults, typeBasedCustomizations[nodeType], typeBasedDockerCommands);
    }
    roleFromPlaceholderArn(scope, region, account, arn) {
        if (!arn) {
            return undefined;
        }
        // Use placeholder arn as construct ID.
        const id = arn;
        // https://github.com/aws/aws-cdk/issues/7255
        let existingRole = constructs_1.Node.of(scope).tryFindChild(`ImmutableRole${id}`);
        if (existingRole) {
            return existingRole;
        }
        // For when #7255 is fixed.
        existingRole = constructs_1.Node.of(scope).tryFindChild(id);
        if (existingRole) {
            return existingRole;
        }
        const arnToImport = cxapi.EnvironmentPlaceholders.replace(arn, {
            region: region !== null && region !== void 0 ? region : core_1.Aws.REGION,
            accountId: account !== null && account !== void 0 ? account : core_1.Aws.ACCOUNT_ID,
            partition: core_1.Aws.PARTITION,
        });
        return iam.Role.fromRoleArn(scope, id, arnToImport, { mutable: false, addGrantsToResources: true });
    }
    /**
     * Non-template config files for CodePipeline actions
     *
     * Currently only supports tags.
     */
    writeTemplateConfiguration(stack) {
        if (Object.keys(stack.tags).length === 0) {
            return undefined;
        }
        const absConfigPath = `${stack.absoluteTemplatePath}.config.json`;
        const relativeConfigPath = path.relative(this.myCxAsmRoot, absConfigPath);
        // Write the template configuration file (for parameters into CreateChangeSet call that
        // cannot be configured any other way). They must come from a file, and there's unfortunately
        // no better hook to write this file (`construct.onSynthesize()` would have been the prime candidate
        // but that is being deprecated--and DeployCdkStackAction isn't even a construct).
        template_configuration_1.writeTemplateConfiguration(absConfigPath, {
            Tags: javascript_1.noUndefined(stack.tags),
        });
        return relativeConfigPath;
    }
    /**
     * This role is used by both the CodePipeline build action and related CodeBuild project. Consolidating these two
     * roles into one, and re-using across all assets, saves significant size of the final synthesized output.
     * Modeled after the CodePipeline role and 'CodePipelineActionRole' roles.
     * Generates one role per asset type to separate file and Docker/image-based permissions.
     */
    obtainAssetCodeBuildRole(assetType) {
        if (this.assetCodeBuildRoles[assetType]) {
            return this.assetCodeBuildRoles[assetType];
        }
        const stack = core_1.Stack.of(this);
        const rolePrefix = assetType === blueprint_1.AssetType.DOCKER_IMAGE ? 'Docker' : 'File';
        const assetRole = new asset_singleton_role_1.AssetSingletonRole(this.assetsScope, `${rolePrefix}Role`, {
            roleName: core_1.PhysicalName.GENERATE_IF_NEEDED,
            assumedBy: new iam.CompositePrincipal(new iam.ServicePrincipal('codebuild.amazonaws.com'), new iam.AccountPrincipal(stack.account)),
        });
        // Publishing role access
        // The ARNs include raw AWS pseudo parameters (e.g., ${AWS::Partition}), which need to be substituted.
        // Lazy-evaluated so all asset publishing roles are included.
        assetRole.addToPolicy(new iam.PolicyStatement({
            actions: ['sts:AssumeRole'],
            resources: core_1.Lazy.list({ produce: () => { var _b; return Array.from((_b = this.assetPublishingRoles[assetType]) !== null && _b !== void 0 ? _b : []).map(arn => core_1.Fn.sub(arn)); } }),
        }));
        // Grant pull access for any ECR registries and secrets that exist
        if (assetType === blueprint_1.AssetType.DOCKER_IMAGE) {
            this.dockerCredentials.forEach(reg => reg.grantRead(assetRole, docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING));
        }
        this.assetCodeBuildRoles[assetType] = assetRole;
        return assetRole;
    }
}
exports.CodePipeline = CodePipeline;
_a = JSII_RTTI_SYMBOL_1;
CodePipeline[_a] = { fqn: "@aws-cdk/pipelines.CodePipeline", version: "1.121.0" };
function dockerUsageFromCodeBuild(cbt) {
    switch (cbt) {
        case CodeBuildProjectType.ASSETS: return docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING;
        case CodeBuildProjectType.SELF_MUTATE: return docker_credentials_1.DockerCredentialUsage.SELF_UPDATE;
        case CodeBuildProjectType.SYNTH: return docker_credentials_1.DockerCredentialUsage.SYNTH;
        case CodeBuildProjectType.STEP: return undefined;
    }
}
var CodeBuildProjectType;
(function (CodeBuildProjectType) {
    CodeBuildProjectType["SYNTH"] = "SYNTH";
    CodeBuildProjectType["ASSETS"] = "ASSETS";
    CodeBuildProjectType["SELF_MUTATE"] = "SELF_MUTATE";
    CodeBuildProjectType["STEP"] = "STEP";
})(CodeBuildProjectType || (CodeBuildProjectType = {}));
function actionName(node, parent) {
    const names = node.ancestorPath(parent).map(n => n.id);
    return names.map(sanitizeName).join('.').substr(0, 100); // Cannot exceed 100 chars
}
function sanitizeName(x) {
    return x.replace(/[^A-Za-z0-9.@\-_]/g, '_');
}
/**
 * Take a set of tranches and split them up into groups so
 * that no set of tranches has more than n items total
 */
function chunkTranches(n, xss) {
    const ret = [];
    while (xss.length > 0) {
        const tranches = [];
        let count = 0;
        while (xss.length > 0) {
            const xs = xss[0];
            const spaceRemaining = n - count;
            if (xs.length <= spaceRemaining) {
                tranches.push(xs);
                count += xs.length;
                xss.shift();
            }
            else {
                tranches.push(xs.splice(0, spaceRemaining));
                count = n;
                break;
            }
        }
        ret.push(tranches);
    }
    return ret;
}
function isCodePipelineActionFactory(x) {
    return !!x.produceAction;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29kZXBpcGVsaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNkJBQTZCO0FBQzdCLDZDQUE2QztBQUM3QyxnREFBZ0Q7QUFDaEQseURBQXlEO0FBRXpELHdDQUF3QztBQUN4Qyx3Q0FBb0Y7QUFDcEYseUNBQXlDO0FBQ3pDLDJDQUE2QztBQUM3Qyw0Q0FBc0k7QUFDdEksOERBQWtIO0FBQ2xILDBEQUF5RztBQUN6RyxrQ0FBdUM7QUFDdkMsMEVBQXFFO0FBQ3JFLHdFQUF3RztBQUN4RyxzQ0FBNEM7QUFDNUMsc0RBQXFGO0FBQ3JGLDhFQUErRTtBQUMvRSw2REFBdUc7QUFDdkcsaURBQTZDO0FBQzdDLHFEQUFpRDs7Ozs7Ozs7OztBQXdFakQsTUFBYSxZQUFhLFNBQVEsbUJBQVk7Ozs7SUEyQjVDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQW1CLEtBQXdCOztRQUNqRixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQURpQyxVQUFLLEdBQUwsS0FBSyxDQUFtQjtRQXpCM0UsY0FBUyxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO1FBTXRDOztXQUVHO1FBQ2Msd0JBQW1CLEdBQThCLEVBQUUsQ0FBQztRQUVyRTs7V0FFRztRQUNjLHlCQUFvQixHQUFnQyxFQUFFLENBQUM7UUFjdEUsSUFBSSxDQUFDLFlBQVksU0FBRyxLQUFLLENBQUMsWUFBWSxtQ0FBSSxJQUFJLENBQUM7UUFDL0MsSUFBSSxDQUFDLGlCQUFpQixTQUFHLEtBQUssQ0FBQyxpQkFBaUIsbUNBQUksRUFBRSxDQUFDO1FBQ3ZELElBQUksQ0FBQywyQkFBMkIsR0FBRyxDQUFDLE9BQUMsS0FBSyxDQUFDLHVCQUF1QixtQ0FBSSxJQUFJLENBQUMsQ0FBQztJQUM5RSxDQUFDOzs7Ozs7OztJQUdELElBQVcsWUFBWTtRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFD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YSxDQUFDO0FBQzNELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgY2IgZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVidWlsZCc7XG5pbXBvcnQgKiBhcyBjcCBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGNwYSBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lLWFjdGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ0Bhd3MtY2RrL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IHsgQXdzLCBDZm5DYXBhYmlsaXRpZXMsIEZuLCBMYXp5LCBQaHlzaWNhbE5hbWUsIFN0YWNrIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuaW1wb3J0IHsgQ29uc3RydWN0LCBOb2RlIH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBBc3NldFR5cGUsIEZpbGVTZXQsIElGaWxlU2V0UHJvZHVjZXIsIE1hbnVhbEFwcHJvdmFsU3RlcCwgU2hlbGxTdGVwLCBTdGFja0Fzc2V0LCBTdGFja0RlcGxveW1lbnQsIFN0ZXAgfSBmcm9tICcuLi9ibHVlcHJpbnQnO1xuaW1wb3J0IHsgRG9ja2VyQ3JlZGVudGlhbCwgZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMsIERvY2tlckNyZWRlbnRpYWxVc2FnZSB9IGZyb20gJy4uL2RvY2tlci1jcmVkZW50aWFscyc7XG5pbXBvcnQgeyBHcmFwaE5vZGUsIEdyYXBoTm9kZUNvbGxlY3Rpb24sIGlzR3JhcGgsIEFHcmFwaE5vZGUsIFBpcGVsaW5lR3JhcGggfSBmcm9tICcuLi9oZWxwZXJzLWludGVybmFsJztcbmltcG9ydCB7IFBpcGVsaW5lQmFzZSB9IGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgQXNzZXRTaW5nbGV0b25Sb2xlIH0gZnJvbSAnLi4vcHJpdmF0ZS9hc3NldC1zaW5nbGV0b24tcm9sZSc7XG5pbXBvcnQgeyBhcHBPZiwgYXNzZW1ibHlCdWlsZGVyT2YsIGVtYmVkZGVkQXNtUGF0aCwgb2J0YWluU2NvcGUgfSBmcm9tICcuLi9wcml2YXRlL2NvbnN0cnVjdC1pbnRlcm5hbHMnO1xuaW1wb3J0IHsgdG9Qb3NpeFBhdGggfSBmcm9tICcuLi9wcml2YXRlL2ZzJztcbmltcG9ydCB7IGVudW1lcmF0ZSwgZmxhdHRlbiwgbWF5YmVTdWZmaXgsIG5vVW5kZWZpbmVkIH0gZnJvbSAnLi4vcHJpdmF0ZS9qYXZhc2NyaXB0JztcbmltcG9ydCB7IHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vcHJpdmF0ZS90ZW1wbGF0ZS1jb25maWd1cmF0aW9uJztcbmltcG9ydCB7IENvZGVCdWlsZEZhY3RvcnksIG1lcmdlQ29kZUJ1aWxkT3B0aW9ucywgc3RhY2tWYXJpYWJsZU5hbWVzcGFjZSB9IGZyb20gJy4vX2NvZGVidWlsZC1mYWN0b3J5JztcbmltcG9ydCB7IEFydGlmYWN0TWFwIH0gZnJvbSAnLi9hcnRpZmFjdC1tYXAnO1xuaW1wb3J0IHsgQ29kZUJ1aWxkU3RlcCB9IGZyb20gJy4vY29kZWJ1aWxkLXN0ZXAnO1xuaW1wb3J0IHsgQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeVJlc3VsdCwgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgfSBmcm9tICcuL2NvZGVwaXBlbGluZS1hY3Rpb24tZmFjdG9yeSc7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5leHBvcnQgaW50ZXJmYWNlIENvZGVQaXBlbGluZVByb3BzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHN5bnRoOiBJRmlsZVNldFByb2R1Y2VyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgcGlwZWxpbmVOYW1lPzogc3RyaW5nO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBjcm9zc0FjY291bnRLZXlzPzogYm9vbGVhbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGNsaVZlcnNpb24/OiBzdHJpbmc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHNlbGZNdXRhdGlvbj86IGJvb2xlYW47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGRvY2tlckVuYWJsZWRGb3JTZWxmTXV0YXRpb24/OiBib29sZWFuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgZG9ja2VyRW5hYmxlZEZvclN5bnRoPzogYm9vbGVhbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGNvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgc3ludGhDb2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IGFzc2V0UHVibGlzaGluZ0NvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgc2VsZk11dGF0aW9uQ29kZUJ1aWxkRGVmYXVsdHM/OiBDb2RlQnVpbGRPcHRpb25zO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBwdWJsaXNoQXNzZXRzSW5QYXJhbGxlbD86IGJvb2xlYW47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgZG9ja2VyQ3JlZGVudGlhbHM/OiBEb2NrZXJDcmVkZW50aWFsW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBjb2RlUGlwZWxpbmU/OiBjcC5QaXBlbGluZTtcbn1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuZXhwb3J0IGludGVyZmFjZSBDb2RlQnVpbGRPcHRpb25zIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBidWlsZEVudmlyb25tZW50PzogY2IuQnVpbGRFbnZpcm9ubWVudDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHJvbGVQb2xpY3k/OiBpYW0uUG9saWN5U3RhdGVtZW50W107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHBhcnRpYWxCdWlsZFNwZWM/OiBjYi5CdWlsZFNwZWM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcmVhZG9ubHkgc2VjdXJpdHlHcm91cHM/OiBlYzIuSVNlY3VyaXR5R3JvdXBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICByZWFkb25seSBzdWJuZXRTZWxlY3Rpb24/OiBlYzIuU3VibmV0U2VsZWN0aW9uO1xufVxuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuZXhwb3J0IGNsYXNzIENvZGVQaXBlbGluZSBleHRlbmRzIFBpcGVsaW5lQmFzZSB7XG4gIHByaXZhdGUgX3BpcGVsaW5lPzogY3AuUGlwZWxpbmU7XG4gIHByaXZhdGUgYXJ0aWZhY3RzID0gbmV3IEFydGlmYWN0TWFwKCk7XG4gIHByaXZhdGUgX3N5bnRoUHJvamVjdD86IGNiLklQcm9qZWN0O1xuICBwcml2YXRlIHJlYWRvbmx5IHNlbGZNdXRhdGlvbjogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfbXlDeEFzbVJvb3Q/OiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZG9ja2VyQ3JlZGVudGlhbHM6IERvY2tlckNyZWRlbnRpYWxbXTtcblxuICAvKipcbiAgICogQXNzZXQgcm9sZXMgc2hhcmVkIGZvciBwdWJsaXNoaW5nXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFzc2V0Q29kZUJ1aWxkUm9sZXM6IFJlY29yZDxzdHJpbmcsIGlhbS5JUm9sZT4gPSB7fTtcblxuICAvKipcbiAgICogUGVyIGFzc2V0IHR5cGUsIHRoZSB0YXJnZXQgcm9sZSBBUk5zIHRoYXQgbmVlZCB0byBiZSBhc3N1bWVkXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFzc2V0UHVibGlzaGluZ1JvbGVzOiBSZWNvcmQ8c3RyaW5nLCBTZXQ8c3RyaW5nPj4gPSB7fTtcblxuICAvKipcbiAgICogVGhpcyBpcyBzZXQgdG8gdGhlIHZlcnkgZmlyc3QgYXJ0aWZhY3QgcHJvZHVjZWQgaW4gdGhlIHBpcGVsaW5lXG4gICAqL1xuICBwcml2YXRlIF9mYWxsYmFja0FydGlmYWN0PzogY3AuQXJ0aWZhY3Q7XG5cbiAgcHJpdmF0ZSBfY2xvdWRBc3NlbWJseUZpbGVTZXQ/OiBGaWxlU2V0O1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByaXZhdGUgcmVhZG9ubHkgcHJvcHM6IENvZGVQaXBlbGluZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICB0aGlzLnNlbGZNdXRhdGlvbiA9IHByb3BzLnNlbGZNdXRhdGlvbiA/PyB0cnVlO1xuICAgIHRoaXMuZG9ja2VyQ3JlZGVudGlhbHMgPSBwcm9wcy5kb2NrZXJDcmVkZW50aWFscyA/PyBbXTtcbiAgICB0aGlzLnNpbmdsZVB1Ymxpc2hlclBlckFzc2V0VHlwZSA9ICEocHJvcHMucHVibGlzaEFzc2V0c0luUGFyYWxsZWwgPz8gdHJ1ZSk7XG4gIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgcHVibGljIGdldCBzeW50aFByb2plY3QoKTogY2IuSVByb2plY3Qge1xuICAgIGlmICghdGhpcy5fc3ludGhQcm9qZWN0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGwgcGlwZWxpbmUuYnVpbGRQaXBlbGluZSgpIGJlZm9yZSByZWFkaW5nIHRoaXMgcHJvcGVydHknKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3N5bnRoUHJvamVjdDtcbiAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIHB1YmxpYyBnZXQgcGlwZWxpbmUoKTogY3AuUGlwZWxpbmUge1xuICAgIGlmICghdGhpcy5fcGlwZWxpbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgbm90IGNyZWF0ZWQgeWV0Jyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9waXBlbGluZTtcbiAgfVxuXG5cbiAgcHJvdGVjdGVkIGRvQnVpbGRQaXBlbGluZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fcGlwZWxpbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgYWxyZWFkeSBjcmVhdGVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy5fbXlDeEFzbVJvb3QgPSBwYXRoLnJlc29sdmUoYXNzZW1ibHlCdWlsZGVyT2YoYXBwT2YodGhpcykpLm91dGRpcik7XG5cbiAgICBpZiAodGhpcy5wcm9wcy5jb2RlUGlwZWxpbmUpIHtcbiAgICAgIGlmICh0aGlzLnByb3BzLnBpcGVsaW5lTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzZXQgXFwncGlwZWxpbmVOYW1lXFwnIGlmIGFuIGV4aXN0aW5nIENvZGVQaXBlbGluZSBpcyBnaXZlbiB1c2luZyBcXCdjb2RlUGlwZWxpbmVcXCcnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnByb3BzLmNyb3NzQWNjb3VudEtleXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzZXQgXFwnY3Jvc3NBY2NvdW50S2V5c1xcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3BpcGVsaW5lID0gdGhpcy5wcm9wcy5jb2RlUGlwZWxpbmU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3BpcGVsaW5lID0gbmV3IGNwLlBpcGVsaW5lKHRoaXMsICdQaXBlbGluZScsIHtcbiAgICAgICAgcGlwZWxpbmVOYW1lOiB0aGlzLnByb3BzLnBpcGVsaW5lTmFtZSxcbiAgICAgICAgY3Jvc3NBY2NvdW50S2V5czogdGhpcy5wcm9wcy5jcm9zc0FjY291bnRLZXlzID8/IGZhbHNlLFxuICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSB0byBtYWtlIHNlbGYtbXV0YXRpb24gd29yayAoZGVwbG95bWVudHMgYXJlIGd1YXJhbnRlZWRcbiAgICAgICAgLy8gdG8gaGFwcGVuIG9ubHkgYWZ0ZXIgdGhlIGJ1aWxkcyBvZiB0aGUgbGF0ZXN0IHBpcGVsaW5lIGRlZmluaXRpb24pLlxuICAgICAgICByZXN0YXJ0RXhlY3V0aW9uT25VcGRhdGU6IHRydWUsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBncmFwaEZyb21CcCA9IG5ldyBQaXBlbGluZUdyYXBoKHRoaXMsIHtcbiAgICAgIHNlbGZNdXRhdGlvbjogdGhpcy5zZWxmTXV0YXRpb24sXG4gICAgICBzaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGU6IHRoaXMuc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlLFxuICAgIH0pO1xuICAgIHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0ID0gZ3JhcGhGcm9tQnAuY2xvdWRBc3NlbWJseUZpbGVTZXQ7XG5cbiAgICB0aGlzLnBpcGVsaW5lU3RhZ2VzQW5kQWN0aW9uc0Zyb21HcmFwaChncmFwaEZyb21CcCk7XG4gIH1cblxuICBwcml2YXRlIGdldCBteUN4QXNtUm9vdCgpOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5fbXlDeEFzbVJvb3QpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuXFwndCByZWFkIFxcJ215Q3hBc21Sb290XFwnIGlmIGJ1aWxkIGRlcGxveW1lbnQgbm90IGNhbGxlZCB5ZXQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX215Q3hBc21Sb290O1xuICB9XG5cbiAgLyoqXG4gICAqIFNjb3BlIGZvciBBc3NldHMtcmVsYXRlZCByZXNvdXJjZXMuXG4gICAqXG4gICAqIFB1cmVseSBleGlzdHMgZm9yIGNvbnN0cnVjdCB0cmVlIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggbGVnYWN5IHBpcGVsaW5lc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXQgYXNzZXRzU2NvcGUoKTogQ29uc3RydWN0IHtcbiAgICByZXR1cm4gb2J0YWluU2NvcGUodGhpcywgJ0Fzc2V0cycpO1xuICB9XG5cbiAgcHJpdmF0ZSBwaXBlbGluZVN0YWdlc0FuZEFjdGlvbnNGcm9tR3JhcGgoc3RydWN0dXJlOiBQaXBlbGluZUdyYXBoKSB7XG4gICAgLy8gVHJhbnNsYXRlIGdyYXBoIGludG8gUGlwZWxpbmUgU3RhZ2VzIGFuZCBBY3Rpb25zXG4gICAgbGV0IGJlZm9yZVNlbGZNdXRhdGlvbiA9IHRoaXMuc2VsZk11dGF0aW9uO1xuICAgIGZvciAoY29uc3Qgc3RhZ2VOb2RlIG9mIGZsYXR0ZW4oc3RydWN0dXJlLmdyYXBoLnNvcnRlZENoaWxkcmVuKCkpKSB7XG4gICAgICBpZiAoIWlzR3JhcGgoc3RhZ2VOb2RlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvcC1sZXZlbCBjaGlsZHJlbiBtdXN0IGJlIGdyYXBocywgZ290ICcke3N0YWdlTm9kZX0nYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdyb3VwIG91ciBvcmRlcmVkIHRyYW5jaGVzIGludG8gYmxvY2tzIG9mIDUwLlxuICAgICAgLy8gV2UgY2FuIG1hcCB0aGVzZSBvbnRvIHN0YWdlcyB3aXRob3V0IGV4Y2VlZGluZyB0aGUgY2FwYWNpdHkgb2YgYSBTdGFnZS5cbiAgICAgIGNvbnN0IGNodW5rcyA9IGNodW5rVHJhbmNoZXMoNTAsIHN0YWdlTm9kZS5zb3J0ZWRMZWF2ZXMoKSk7XG4gICAgICBjb25zdCBhY3Rpb25zT3ZlcmZsb3dTdGFnZSA9IGNodW5rcy5sZW5ndGggPiAxO1xuICAgICAgZm9yIChjb25zdCBbaSwgdHJhbmNoZXNdIG9mIGVudW1lcmF0ZShjaHVua3MpKSB7XG4gICAgICAgIGNvbnN0IHN0YWdlTmFtZSA9IGFjdGlvbnNPdmVyZmxvd1N0YWdlID8gYCR7c3RhZ2VOb2RlLmlkfS4ke2kgKyAxfWAgOiBzdGFnZU5vZGUuaWQ7XG4gICAgICAgIGNvbnN0IHBpcGVsaW5lU3RhZ2UgPSB0aGlzLnBpcGVsaW5lLmFkZFN0YWdlKHsgc3RhZ2VOYW1lIH0pO1xuXG4gICAgICAgIGNvbnN0IHNoYXJlZFBhcmVudCA9IG5ldyBHcmFwaE5vZGVDb2xsZWN0aW9uKGZsYXR0ZW4odHJhbmNoZXMpKS5jb21tb25BbmNlc3RvcigpO1xuXG4gICAgICAgIGxldCBydW5PcmRlciA9IDE7XG4gICAgICAgIGZvciAoY29uc3QgdHJhbmNoZSBvZiB0cmFuY2hlcykge1xuICAgICAgICAgIGNvbnN0IHJ1bk9yZGVyc0NvbnN1bWVkID0gWzBdO1xuXG4gICAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRyYW5jaGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLmFjdGlvbkZyb21Ob2RlKG5vZGUpO1xuXG4gICAgICAgICAgICBjb25zdCBub2RlVHlwZSA9IHRoaXMubm9kZVR5cGVGcm9tTm9kZShub2RlKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZmFjdG9yeS5wcm9kdWNlQWN0aW9uKHBpcGVsaW5lU3RhZ2UsIHtcbiAgICAgICAgICAgICAgYWN0aW9uTmFtZTogYWN0aW9uTmFtZShub2RlLCBzaGFyZWRQYXJlbnQpLFxuICAgICAgICAgICAgICBydW5PcmRlcixcbiAgICAgICAgICAgICAgYXJ0aWZhY3RzOiB0aGlzLmFydGlmYWN0cyxcbiAgICAgICAgICAgICAgc2NvcGU6IG9idGFpblNjb3BlKHRoaXMucGlwZWxpbmUsIHN0YWdlTmFtZSksXG4gICAgICAgICAgICAgIGZhbGxiYWNrQXJ0aWZhY3Q6IHRoaXMuX2ZhbGxiYWNrQXJ0aWZhY3QsXG4gICAgICAgICAgICAgIHBpcGVsaW5lOiB0aGlzLFxuICAgICAgICAgICAgICAvLyBJZiB0aGlzIHN0ZXAgaGFwcGVucyB0byBwcm9kdWNlIGEgQ29kZUJ1aWxkIGpvYiwgc2V0IHRoZSBkZWZhdWx0IG9wdGlvbnNcbiAgICAgICAgICAgICAgY29kZUJ1aWxkRGVmYXVsdHM6IG5vZGVUeXBlID8gdGhpcy5jb2RlQnVpbGREZWZhdWx0c0Zvcihub2RlVHlwZSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIGJlZm9yZVNlbGZNdXRhdGlvbixcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc2VsZi11cGRhdGUnKSB7XG4gICAgICAgICAgICAgIGJlZm9yZVNlbGZNdXRhdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnBvc3RQcm9jZXNzTm9kZShub2RlLCByZXN1bHQpO1xuXG4gICAgICAgICAgICBydW5PcmRlcnNDb25zdW1lZC5wdXNoKHJlc3VsdC5ydW5PcmRlcnNDb25zdW1lZCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcnVuT3JkZXIgKz0gTWF0aC5tYXgoLi4ucnVuT3JkZXJzQ29uc3VtZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERvIGFkZGl0aW9uYWwgdGhpbmdzIGFmdGVyIHRoZSBhY3Rpb24gZ290IGFkZGVkIHRvIHRoZSBwaXBlbGluZVxuICAgKlxuICAgKiBTb21lIG1pbm9yIHN0YXRlIG1hbmlwdWxhdGlvbiBvZiBDb2RlQnVpbGQgcHJvamVjdHMgYW5kIHBpcGVsaW5lXG4gICAqIGFydGlmYWN0cy5cbiAgICovXG4gIHByaXZhdGUgcG9zdFByb2Nlc3NOb2RlKG5vZGU6IEFHcmFwaE5vZGUsIHJlc3VsdDogQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeVJlc3VsdCkge1xuICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuXG4gICAgaWYgKHJlc3VsdC5wcm9qZWN0KSB7XG4gICAgICBjb25zdCBkb2NrZXJVc2FnZSA9IGRvY2tlclVzYWdlRnJvbUNvZGVCdWlsZChub2RlVHlwZSA/PyBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TVEVQKTtcbiAgICAgIGlmIChkb2NrZXJVc2FnZSkge1xuICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5kb2NrZXJDcmVkZW50aWFscykge1xuICAgICAgICAgIGMuZ3JhbnRSZWFkKHJlc3VsdC5wcm9qZWN0LCBkb2NrZXJVc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG5vZGVUeXBlID09PSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USCkge1xuICAgICAgICB0aGlzLl9zeW50aFByb2plY3QgPSByZXN1bHQucHJvamVjdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc3RlcCcgJiYgbm9kZS5kYXRhLnN0ZXAucHJpbWFyeU91dHB1dD8ucHJpbWFyeU91dHB1dCAmJiAhdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCkge1xuICAgICAgdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCA9IHRoaXMuYXJ0aWZhY3RzLnRvQ29kZVBpcGVsaW5lKG5vZGUuZGF0YS5zdGVwLnByaW1hcnlPdXRwdXQ/LnByaW1hcnlPdXRwdXQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIGFuIGFjdGlvbiBmcm9tIHRoZSBnaXZlbiBub2RlIGFuZC9vciBzdGVwXG4gICAqL1xuICBwcml2YXRlIGFjdGlvbkZyb21Ob2RlKG5vZGU6IEFHcmFwaE5vZGUpOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgc3dpdGNoIChub2RlLmRhdGE/LnR5cGUpIHtcbiAgICAgIC8vIE5vdGhpbmcgZm9yIHRoZXNlLCB0aGV5IGFyZSBncm91cGluZ3MgKHNob3VsZG4ndCBldmVuIGhhdmUgcG9wcGVkIHVwIGhlcmUpXG4gICAgICBjYXNlICdncm91cCc6XG4gICAgICBjYXNlICdzdGFjay1ncm91cCc6XG4gICAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBhY3Rpb25Gcm9tTm9kZTogZGlkIG5vdCBleHBlY3QgdG8gZ2V0IGdyb3VwIG5vZGVzOiAke25vZGUuZGF0YT8udHlwZX1gKTtcblxuICAgICAgY2FzZSAnc2VsZi11cGRhdGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5zZWxmTXV0YXRlQWN0aW9uKCk7XG5cbiAgICAgIGNhc2UgJ3B1Ymxpc2gtYXNzZXRzJzpcbiAgICAgICAgcmV0dXJuIHRoaXMucHVibGlzaEFzc2V0c0FjdGlvbihub2RlLCBub2RlLmRhdGEuYXNzZXRzKTtcblxuICAgICAgY2FzZSAncHJlcGFyZSc6XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNoYW5nZVNldEFjdGlvbihub2RlLmRhdGEuc3RhY2spO1xuXG4gICAgICBjYXNlICdleGVjdXRlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZUNoYW5nZVNldEFjdGlvbihub2RlLmRhdGEuc3RhY2ssIG5vZGUuZGF0YS5jYXB0dXJlT3V0cHV0cyk7XG5cbiAgICAgIGNhc2UgJ3N0ZXAnOlxuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25Gcm9tU3RlcChub2RlLCBub2RlLmRhdGEuc3RlcCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRha2UgYSBTdGVwIGFuZCB0dXJuIGl0IGludG8gYSBDb2RlUGlwZWxpbmUgQWN0aW9uXG4gICAqXG4gICAqIFRoZXJlIGFyZSBvbmx5IDMgdHlwZXMgb2YgU3RlcHMgd2UgbmVlZCB0byBzdXBwb3J0OlxuICAgKlxuICAgKiAtIFNoZWxsIChnZW5lcmljKVxuICAgKiAtIE1hbnVhbEFwcHJvdmFsIChnZW5lcmljKVxuICAgKiAtIENvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgKENvZGVQaXBlbGluZS1zcGVjaWZpYylcbiAgICpcbiAgICogVGhlIHJlc3QgaXMgZXhwcmVzc2VkIGluIHRlcm1zIG9mIHRoZXNlIDMsIG9yIGluIHRlcm1zIG9mIGdyYXBoIG5vZGVzXG4gICAqIHdoaWNoIGFyZSBoYW5kbGVkIGVsc2V3aGVyZS5cbiAgICovXG4gIHByaXZhdGUgYWN0aW9uRnJvbVN0ZXAobm9kZTogQUdyYXBoTm9kZSwgc3RlcDogU3RlcCk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBub2RlVHlwZSA9IHRoaXMubm9kZVR5cGVGcm9tTm9kZShub2RlKTtcblxuICAgIC8vIENvZGVQaXBlbGluZS1zcGVjaWZpYyBzdGVwcyBmaXJzdCAtLSB0aGlzIGluY2x1ZGVzIFNvdXJjZXNcbiAgICBpZiAoaXNDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5KHN0ZXApKSB7XG4gICAgICByZXR1cm4gc3RlcDtcbiAgICB9XG5cbiAgICAvLyBOb3cgYnVpbHQtaW4gc3RlcHNcbiAgICBpZiAoc3RlcCBpbnN0YW5jZW9mIFNoZWxsU3RlcCB8fCBzdGVwIGluc3RhbmNlb2YgQ29kZUJ1aWxkU3RlcCkge1xuICAgICAgLy8gVGhlICdDZGtCdWlsZFByb2plY3QnIHdpbGwgYmUgdGhlIGNvbnN0cnVjdCBJRCBvZiB0aGUgQ29kZUJ1aWxkIHByb2plY3QsIG5lY2Vzc2FyeSBmb3IgYmFja3dhcmRzIGNvbXBhdFxuICAgICAgbGV0IGNvbnN0cnVjdElkID0gbm9kZVR5cGUgPT09IENvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIXG4gICAgICAgID8gJ0Nka0J1aWxkUHJvamVjdCdcbiAgICAgICAgOiBzdGVwLmlkO1xuXG4gICAgICByZXR1cm4gc3RlcCBpbnN0YW5jZW9mIENvZGVCdWlsZFN0ZXBcbiAgICAgICAgPyBDb2RlQnVpbGRGYWN0b3J5LmZyb21Db2RlQnVpbGRTdGVwKGNvbnN0cnVjdElkLCBzdGVwKVxuICAgICAgICA6IENvZGVCdWlsZEZhY3RvcnkuZnJvbVNoZWxsU3RlcChjb25zdHJ1Y3RJZCwgc3RlcCk7XG4gICAgfVxuXG4gICAgaWYgKHN0ZXAgaW5zdGFuY2VvZiBNYW51YWxBcHByb3ZhbFN0ZXApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2R1Y2VBY3Rpb246IChzdGFnZSwgb3B0aW9ucykgPT4ge1xuICAgICAgICAgIHN0YWdlLmFkZEFjdGlvbihuZXcgY3BhLk1hbnVhbEFwcHJvdmFsQWN0aW9uKHtcbiAgICAgICAgICAgIGFjdGlvbk5hbWU6IG9wdGlvbnMuYWN0aW9uTmFtZSxcbiAgICAgICAgICAgIHJ1bk9yZGVyOiBvcHRpb25zLnJ1bk9yZGVyLFxuICAgICAgICAgICAgYWRkaXRpb25hbEluZm9ybWF0aW9uOiBzdGVwLmNvbW1lbnQsXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIHJldHVybiB7IHJ1bk9yZGVyc0NvbnN1bWVkOiAxIH07XG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgRGVwbG95bWVudCBzdGVwICcke3N0ZXB9JyBpcyBub3Qgc3VwcG9ydGVkIGZvciBDb2RlUGlwZWxpbmUtYmFja2VkIHBpcGVsaW5lc2ApO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDaGFuZ2VTZXRBY3Rpb24oc3RhY2s6IFN0YWNrRGVwbG95bWVudCk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBjaGFuZ2VTZXROYW1lID0gJ1BpcGVsaW5lQ2hhbmdlJztcblxuICAgIGNvbnN0IHRlbXBsYXRlQXJ0aWZhY3QgPSB0aGlzLmFydGlmYWN0cy50b0NvZGVQaXBlbGluZSh0aGlzLl9jbG91ZEFzc2VtYmx5RmlsZVNldCEpO1xuICAgIGNvbnN0IHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGggPSB0aGlzLndyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKHN0YWNrKTtcblxuICAgIGNvbnN0IHJlZ2lvbiA9IHN0YWNrLnJlZ2lvbiAhPT0gU3RhY2sub2YodGhpcykucmVnaW9uID8gc3RhY2sucmVnaW9uIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGFjY291bnQgPSBzdGFjay5hY2NvdW50ICE9PSBTdGFjay5vZih0aGlzKS5hY2NvdW50ID8gc3RhY2suYWNjb3VudCA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IHJlbGF0aXZlVGVtcGxhdGVQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBzdGFjay5hYnNvbHV0ZVRlbXBsYXRlUGF0aCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJvZHVjZUFjdGlvbjogKHN0YWdlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgIHN0YWdlLmFkZEFjdGlvbihuZXcgY3BhLkNsb3VkRm9ybWF0aW9uQ3JlYXRlUmVwbGFjZUNoYW5nZVNldEFjdGlvbih7XG4gICAgICAgICAgYWN0aW9uTmFtZTogb3B0aW9ucy5hY3Rpb25OYW1lLFxuICAgICAgICAgIHJ1bk9yZGVyOiBvcHRpb25zLnJ1bk9yZGVyLFxuICAgICAgICAgIGNoYW5nZVNldE5hbWUsXG4gICAgICAgICAgc3RhY2tOYW1lOiBzdGFjay5zdGFja05hbWUsXG4gICAgICAgICAgdGVtcGxhdGVQYXRoOiB0ZW1wbGF0ZUFydGlmYWN0LmF0UGF0aCh0b1Bvc2l4UGF0aChyZWxhdGl2ZVRlbXBsYXRlUGF0aCkpLFxuICAgICAgICAgIGFkbWluUGVybWlzc2lvbnM6IHRydWUsXG4gICAgICAgICAgcm9sZTogdGhpcy5yb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHRoaXMucGlwZWxpbmUsIHJlZ2lvbiwgYWNjb3VudCwgc3RhY2suYXNzdW1lUm9sZUFybiksXG4gICAgICAgICAgZGVwbG95bWVudFJvbGU6IHRoaXMucm9sZUZyb21QbGFjZWhvbGRlckFybih0aGlzLnBpcGVsaW5lLCByZWdpb24sIGFjY291bnQsIHN0YWNrLmV4ZWN1dGlvblJvbGVBcm4pLFxuICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgIHRlbXBsYXRlQ29uZmlndXJhdGlvbjogdGVtcGxhdGVDb25maWd1cmF0aW9uUGF0aFxuICAgICAgICAgICAgPyB0ZW1wbGF0ZUFydGlmYWN0LmF0UGF0aCh0b1Bvc2l4UGF0aCh0ZW1wbGF0ZUNvbmZpZ3VyYXRpb25QYXRoKSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgIGNmbkNhcGFiaWxpdGllczogW0NmbkNhcGFiaWxpdGllcy5OQU1FRF9JQU0sIENmbkNhcGFiaWxpdGllcy5BVVRPX0VYUEFORF0sXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHsgcnVuT3JkZXJzQ29uc3VtZWQ6IDEgfTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZXhlY3V0ZUNoYW5nZVNldEFjdGlvbihzdGFjazogU3RhY2tEZXBsb3ltZW50LCBjYXB0dXJlT3V0cHV0czogYm9vbGVhbik6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBjaGFuZ2VTZXROYW1lID0gJ1BpcGVsaW5lQ2hhbmdlJztcblxuICAgIGNvbnN0IHJlZ2lvbiA9IHN0YWNrLnJlZ2lvbiAhPT0gU3RhY2sub2YodGhpcykucmVnaW9uID8gc3RhY2sucmVnaW9uIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGFjY291bnQgPSBzdGFjay5hY2NvdW50ICE9PSBTdGFjay5vZih0aGlzKS5hY2NvdW50ID8gc3RhY2suYWNjb3VudCA6IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB7XG4gICAgICBwcm9kdWNlQWN0aW9uOiAoc3RhZ2UsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgc3RhZ2UuYWRkQWN0aW9uKG5ldyBjcGEuQ2xvdWRGb3JtYXRpb25FeGVjdXRlQ2hhbmdlU2V0QWN0aW9uKHtcbiAgICAgICAgICBhY3Rpb25OYW1lOiBvcHRpb25zLmFjdGlvbk5hbWUsXG4gICAgICAgICAgcnVuT3JkZXI6IG9wdGlvbnMucnVuT3JkZXIsXG4gICAgICAgICAgY2hhbmdlU2V0TmFtZSxcbiAgICAgICAgICBzdGFja05hbWU6IHN0YWNrLnN0YWNrTmFtZSxcbiAgICAgICAgICByb2xlOiB0aGlzLnJvbGVGcm9tUGxhY2Vob2xkZXJBcm4odGhpcy5waXBlbGluZSwgcmVnaW9uLCBhY2NvdW50LCBzdGFjay5hc3N1bWVSb2xlQXJuKSxcbiAgICAgICAgICByZWdpb246IHJlZ2lvbixcbiAgICAgICAgICB2YXJpYWJsZXNOYW1lc3BhY2U6IGNhcHR1cmVPdXRwdXRzID8gc3RhY2tWYXJpYWJsZU5hbWVzcGFjZShzdGFjaykgOiB1bmRlZmluZWQsXG4gICAgICAgIH0pKTtcblxuICAgICAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxmTXV0YXRlQWN0aW9uKCk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBpbnN0YWxsU3VmZml4ID0gdGhpcy5wcm9wcy5jbGlWZXJzaW9uID8gYEAke3RoaXMucHJvcHMuY2xpVmVyc2lvbn1gIDogJyc7XG5cbiAgICBjb25zdCBwaXBlbGluZVN0YWNrID0gU3RhY2sub2YodGhpcy5waXBlbGluZSk7XG4gICAgY29uc3QgcGlwZWxpbmVTdGFja0lkZW50aWZpZXIgPSBwaXBlbGluZVN0YWNrLm5vZGUucGF0aCA/PyBwaXBlbGluZVN0YWNrLnN0YWNrTmFtZTtcblxuICAgIGNvbnN0IHN0ZXAgPSBuZXcgQ29kZUJ1aWxkU3RlcCgnU2VsZk11dGF0ZScsIHtcbiAgICAgIHByb2plY3ROYW1lOiBtYXliZVN1ZmZpeCh0aGlzLnByb3BzLnBpcGVsaW5lTmFtZSwgJy1zZWxmdXBkYXRlJyksXG4gICAgICBpbnB1dDogdGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQsXG4gICAgICBpbnN0YWxsQ29tbWFuZHM6IFtcbiAgICAgICAgYG5wbSBpbnN0YWxsIC1nIGF3cy1jZGske2luc3RhbGxTdWZmaXh9YCxcbiAgICAgIF0sXG4gICAgICBjb21tYW5kczogW1xuICAgICAgICBgY2RrIC1hICR7dG9Qb3NpeFBhdGgoZW1iZWRkZWRBc21QYXRoKHRoaXMucGlwZWxpbmUpKX0gZGVwbG95ICR7cGlwZWxpbmVTdGFja0lkZW50aWZpZXJ9IC0tcmVxdWlyZS1hcHByb3ZhbD1uZXZlciAtLXZlcmJvc2VgLFxuICAgICAgXSxcblxuICAgICAgcm9sZVBvbGljeVN0YXRlbWVudHM6IFtcbiAgICAgICAgLy8gYWxsb3cgdGhlIHNlbGYtbXV0YXRpbmcgcHJvamVjdCBwZXJtaXNzaW9ucyB0byBhc3N1bWUgdGhlIGJvb3RzdHJhcCBBY3Rpb24gcm9sZVxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzdHM6QXNzdW1lUm9sZSddLFxuICAgICAgICAgIHJlc291cmNlczogW2Bhcm46KjppYW06OiR7U3RhY2sub2YodGhpcy5waXBlbGluZSkuYWNjb3VudH06cm9sZS8qYF0sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgJ0ZvckFueVZhbHVlOlN0cmluZ0VxdWFscyc6IHtcbiAgICAgICAgICAgICAgJ2lhbTpSZXNvdXJjZVRhZy9hd3MtY2RrOmJvb3RzdHJhcC1yb2xlJzogWydpbWFnZS1wdWJsaXNoaW5nJywgJ2ZpbGUtcHVibGlzaGluZycsICdkZXBsb3knXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ2Nsb3VkZm9ybWF0aW9uOkRlc2NyaWJlU3RhY2tzJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSwgLy8gdGhpcyBpcyBuZWVkZWQgdG8gY2hlY2sgdGhlIHN0YXR1cyBvZiB0aGUgYm9vdHN0cmFwIHN0YWNrIHdoZW4gZG9pbmcgYGNkayBkZXBsb3lgXG4gICAgICAgIH0pLFxuICAgICAgICAvLyBTMyBjaGVja3MgZm9yIHRoZSBwcmVzZW5jZSBvZiB0aGUgTGlzdEJ1Y2tldCBwZXJtaXNzaW9uXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3MzOkxpc3RCdWNrZXQnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBEaWZmZXJlbnQgb24gcHVycG9zZSAtLSBpZCBuZWVkZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmxlIExvZ2ljYWxJRFxuICAgIHJldHVybiBDb2RlQnVpbGRGYWN0b3J5LmZyb21Db2RlQnVpbGRTdGVwKCdTZWxmTXV0YXRpb24nLCBzdGVwLCB7XG4gICAgICBhZGRpdGlvbmFsQ29uc3RydWN0TGV2ZWw6IGZhbHNlLFxuICAgICAgc2NvcGU6IG9idGFpblNjb3BlKHRoaXMsICdVcGRhdGVQaXBlbGluZScpLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwdWJsaXNoQXNzZXRzQWN0aW9uKG5vZGU6IEFHcmFwaE5vZGUsIGFzc2V0czogU3RhY2tBc3NldFtdKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGluc3RhbGxTdWZmaXggPSB0aGlzLnByb3BzLmNsaVZlcnNpb24gPyBgQCR7dGhpcy5wcm9wcy5jbGlWZXJzaW9ufWAgOiAnJztcblxuICAgIGNvbnN0IGNvbW1hbmRzID0gYXNzZXRzLm1hcChhc3NldCA9PiB7XG4gICAgICBjb25zdCByZWxhdGl2ZUFzc2V0TWFuaWZlc3RQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBhc3NldC5hc3NldE1hbmlmZXN0UGF0aCk7XG4gICAgICByZXR1cm4gYGNkay1hc3NldHMgLS1wYXRoIFwiJHt0b1Bvc2l4UGF0aChyZWxhdGl2ZUFzc2V0TWFuaWZlc3RQYXRoKX1cIiAtLXZlcmJvc2UgcHVibGlzaCBcIiR7YXNzZXQuYXNzZXRTZWxlY3Rvcn1cImA7XG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NldFR5cGUgPSBhc3NldHNbMF0uYXNzZXRUeXBlO1xuICAgIGlmIChhc3NldHMuc29tZShhID0+IGEuYXNzZXRUeXBlICE9PSBhc3NldFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FsbCBhc3NldHMgaW4gYSBzaW5nbGUgcHVibGlzaGluZyBzdGVwIG11c3QgYmUgb2YgdGhlIHNhbWUgdHlwZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHB1Ymxpc2hpbmdSb2xlcyA9IHRoaXMuYXNzZXRQdWJsaXNoaW5nUm9sZXNbYXNzZXRUeXBlXSA9ICh0aGlzLmFzc2V0UHVibGlzaGluZ1JvbGVzW2Fzc2V0VHlwZV0gPz8gbmV3IFNldCgpKTtcbiAgICBmb3IgKGNvbnN0IGFzc2V0IG9mIGFzc2V0cykge1xuICAgICAgaWYgKGFzc2V0LmFzc2V0UHVibGlzaGluZ1JvbGVBcm4pIHtcbiAgICAgICAgcHVibGlzaGluZ1JvbGVzLmFkZChhc3NldC5hc3NldFB1Ymxpc2hpbmdSb2xlQXJuKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByb2xlID0gdGhpcy5vYnRhaW5Bc3NldENvZGVCdWlsZFJvbGUoYXNzZXRzWzBdLmFzc2V0VHlwZSk7XG5cbiAgICAvLyBUaGUgYmFzZSBjb21tYW5kcyB0aGF0IG5lZWQgdG8gYmUgcnVuXG4gICAgY29uc3Qgc2NyaXB0ID0gbmV3IENvZGVCdWlsZFN0ZXAobm9kZS5pZCwge1xuICAgICAgY29tbWFuZHMsXG4gICAgICBpbnN0YWxsQ29tbWFuZHM6IFtcbiAgICAgICAgYG5wbSBpbnN0YWxsIC1nIGNkay1hc3NldHMke2luc3RhbGxTdWZmaXh9YCxcbiAgICAgIF0sXG4gICAgICBpbnB1dDogdGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQsXG4gICAgICBidWlsZEVudmlyb25tZW50OiB7XG4gICAgICAgIHByaXZpbGVnZWQ6IGFzc2V0cy5zb21lKGFzc2V0ID0+IGFzc2V0LmFzc2V0VHlwZSA9PT0gQXNzZXRUeXBlLkRPQ0tFUl9JTUFHRSksXG4gICAgICB9LFxuICAgICAgcm9sZSxcbiAgICB9KTtcblxuICAgIC8vIEN1c3RvbWl6YXRpb25zIHRoYXQgYXJlIG5vdCBhY2Nlc3NpYmxlIHRvIHJlZ3VsYXIgdXNlcnNcbiAgICByZXR1cm4gQ29kZUJ1aWxkRmFjdG9yeS5mcm9tQ29kZUJ1aWxkU3RlcChub2RlLmlkLCBzY3JpcHQsIHtcbiAgICAgIGFkZGl0aW9uYWxDb25zdHJ1Y3RMZXZlbDogZmFsc2UsXG5cbiAgICAgIC8vIElmIHdlIHVzZSBhIHNpbmdsZSBwdWJsaXNoZXIsIHBhc3MgYnVpbGRzcGVjIHZpYSBmaWxlIG90aGVyd2lzZSBpdCdsbFxuICAgICAgLy8gZ3JvdyB0b28gYmlnLlxuICAgICAgcGFzc0J1aWxkU3BlY1ZpYUNsb3VkQXNzZW1ibHk6IHRoaXMuc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlLFxuICAgICAgc2NvcGU6IHRoaXMuYXNzZXRzU2NvcGUsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG5vZGVUeXBlRnJvbU5vZGUobm9kZTogQUdyYXBoTm9kZSkge1xuICAgIGlmIChub2RlLmRhdGE/LnR5cGUgPT09ICdzdGVwJykge1xuICAgICAgcmV0dXJuICEhbm9kZS5kYXRhPy5pc0J1aWxkU3RlcCA/IENvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIIDogQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUDtcbiAgICB9XG4gICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3B1Ymxpc2gtYXNzZXRzJykge1xuICAgICAgcmV0dXJuIENvZGVCdWlsZFByb2plY3RUeXBlLkFTU0VUUztcbiAgICB9XG4gICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3NlbGYtdXBkYXRlJykge1xuICAgICAgcmV0dXJuIENvZGVCdWlsZFByb2plY3RUeXBlLlNFTEZfTVVUQVRFO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBjb2RlQnVpbGREZWZhdWx0c0Zvcihub2RlVHlwZTogQ29kZUJ1aWxkUHJvamVjdFR5cGUpOiBDb2RlQnVpbGRPcHRpb25zIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBkZWZhdWx0T3B0aW9uczogQ29kZUJ1aWxkT3B0aW9ucyA9IHtcbiAgICAgIGJ1aWxkRW52aXJvbm1lbnQ6IHtcbiAgICAgICAgYnVpbGRJbWFnZTogY2IuTGludXhCdWlsZEltYWdlLlNUQU5EQVJEXzVfMCxcbiAgICAgICAgY29tcHV0ZVR5cGU6IGNiLkNvbXB1dGVUeXBlLlNNQUxMLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgdHlwZUJhc2VkQ3VzdG9taXphdGlvbnMgPSB7XG4gICAgICBbQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEhdOiB0aGlzLnByb3BzLmRvY2tlckVuYWJsZWRGb3JTeW50aFxuICAgICAgICA/IG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyh0aGlzLnByb3BzLnN5bnRoQ29kZUJ1aWxkRGVmYXVsdHMsIHsgYnVpbGRFbnZpcm9ubWVudDogeyBwcml2aWxlZ2VkOiB0cnVlIH0gfSlcbiAgICAgICAgOiB0aGlzLnByb3BzLnN5bnRoQ29kZUJ1aWxkRGVmYXVsdHMsXG5cbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5BU1NFVFNdOiB0aGlzLnByb3BzLmFzc2V0UHVibGlzaGluZ0NvZGVCdWlsZERlZmF1bHRzLFxuXG4gICAgICBbQ29kZUJ1aWxkUHJvamVjdFR5cGUuU0VMRl9NVVRBVEVdOiB0aGlzLnByb3BzLmRvY2tlckVuYWJsZWRGb3JTZWxmTXV0YXRpb25cbiAgICAgICAgPyBtZXJnZUNvZGVCdWlsZE9wdGlvbnModGhpcy5wcm9wcy5zZWxmTXV0YXRpb25Db2RlQnVpbGREZWZhdWx0cywgeyBidWlsZEVudmlyb25tZW50OiB7IHByaXZpbGVnZWQ6IHRydWUgfSB9KVxuICAgICAgICA6IHRoaXMucHJvcHMuc2VsZk11dGF0aW9uQ29kZUJ1aWxkRGVmYXVsdHMsXG5cbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5TVEVQXToge30sXG4gICAgfTtcblxuICAgIGNvbnN0IGRvY2tlclVzYWdlID0gZG9ja2VyVXNhZ2VGcm9tQ29kZUJ1aWxkKG5vZGVUeXBlKTtcbiAgICBjb25zdCBkb2NrZXJDb21tYW5kcyA9IGRvY2tlclVzYWdlICE9PSB1bmRlZmluZWRcbiAgICAgID8gZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMoZG9ja2VyVXNhZ2UsIHRoaXMuZG9ja2VyQ3JlZGVudGlhbHMsICdib3RoJylcbiAgICAgIDogW107XG4gICAgY29uc3QgdHlwZUJhc2VkRG9ja2VyQ29tbWFuZHMgPSBkb2NrZXJDb21tYW5kcy5sZW5ndGggPiAwID8ge1xuICAgICAgcGFydGlhbEJ1aWxkU3BlYzogY2IuQnVpbGRTcGVjLmZyb21PYmplY3Qoe1xuICAgICAgICB2ZXJzaW9uOiAnMC4yJyxcbiAgICAgICAgcGhhc2VzOiB7XG4gICAgICAgICAgcHJlX2J1aWxkOiB7XG4gICAgICAgICAgICBjb21tYW5kczogZG9ja2VyQ29tbWFuZHMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0gOiB7fTtcblxuICAgIHJldHVybiBtZXJnZUNvZGVCdWlsZE9wdGlvbnMoXG4gICAgICBkZWZhdWx0T3B0aW9ucyxcbiAgICAgIHRoaXMucHJvcHMuY29kZUJ1aWxkRGVmYXVsdHMsXG4gICAgICB0eXBlQmFzZWRDdXN0b21pemF0aW9uc1tub2RlVHlwZV0sXG4gICAgICB0eXBlQmFzZWREb2NrZXJDb21tYW5kcyxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSByb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHNjb3BlOiBDb25zdHJ1Y3QsIHJlZ2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIGFjY291bnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgYXJuOiBzdHJpbmcpOiBpYW0uSVJvbGU7XG4gIHByaXZhdGUgcm9sZUZyb21QbGFjZWhvbGRlckFybihzY29wZTogQ29uc3RydWN0LCByZWdpb246IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBhY2NvdW50OiBzdHJpbmcgfCB1bmRlZmluZWQsIGFybjogc3RyaW5nIHwgdW5kZWZpbmVkKTogaWFtLklSb2xlIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHJvbGVGcm9tUGxhY2Vob2xkZXJBcm4oc2NvcGU6IENvbnN0cnVjdCwgcmVnaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgYWNjb3VudDogc3RyaW5nIHwgdW5kZWZpbmVkLCBhcm46IHN0cmluZyB8IHVuZGVmaW5lZCk6IGlhbS5JUm9sZSB8IHVuZGVmaW5lZCB7XG5cbiAgICBpZiAoIWFybikgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG5cbiAgICAvLyBVc2UgcGxhY2Vob2xkZXIgYXJuIGFzIGNvbnN0cnVjdCBJRC5cbiAgICBjb25zdCBpZCA9IGFybjtcblxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hd3MvYXdzLWNkay9pc3N1ZXMvNzI1NVxuICAgIGxldCBleGlzdGluZ1JvbGUgPSBOb2RlLm9mKHNjb3BlKS50cnlGaW5kQ2hpbGQoYEltbXV0YWJsZVJvbGUke2lkfWApIGFzIGlhbS5JUm9sZTtcbiAgICBpZiAoZXhpc3RpbmdSb2xlKSB7IHJldHVybiBleGlzdGluZ1JvbGU7IH1cbiAgICAvLyBGb3Igd2hlbiAjNzI1NSBpcyBmaXhlZC5cbiAgICBleGlzdGluZ1JvbGUgPSBOb2RlLm9mKHNjb3BlKS50cnlGaW5kQ2hpbGQoaWQpIGFzIGlhbS5JUm9sZTtcbiAgICBpZiAoZXhpc3RpbmdSb2xlKSB7IHJldHVybiBleGlzdGluZ1JvbGU7IH1cblxuICAgIGNvbnN0IGFyblRvSW1wb3J0ID0gY3hhcGkuRW52aXJvbm1lbnRQbGFjZWhvbGRlcnMucmVwbGFjZShhcm4sIHtcbiAgICAgIHJlZ2lvbjogcmVnaW9uID8/IEF3cy5SRUdJT04sXG4gICAgICBhY2NvdW50SWQ6IGFjY291bnQgPz8gQXdzLkFDQ09VTlRfSUQsXG4gICAgICBwYXJ0aXRpb246IEF3cy5QQVJUSVRJT04sXG4gICAgfSk7XG4gICAgcmV0dXJuIGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHNjb3BlLCBpZCwgYXJuVG9JbXBvcnQsIHsgbXV0YWJsZTogZmFsc2UsIGFkZEdyYW50c1RvUmVzb3VyY2VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vbi10ZW1wbGF0ZSBjb25maWcgZmlsZXMgZm9yIENvZGVQaXBlbGluZSBhY3Rpb25zXG4gICAqXG4gICAqIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIHRhZ3MuXG4gICAqL1xuICBwcml2YXRlIHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmIChPYmplY3Qua2V5cyhzdGFjay50YWdzKS5sZW5ndGggPT09IDApIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuXG4gICAgY29uc3QgYWJzQ29uZmlnUGF0aCA9IGAke3N0YWNrLmFic29sdXRlVGVtcGxhdGVQYXRofS5jb25maWcuanNvbmA7XG4gICAgY29uc3QgcmVsYXRpdmVDb25maWdQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBhYnNDb25maWdQYXRoKTtcblxuICAgIC8vIFdyaXRlIHRoZSB0ZW1wbGF0ZSBjb25maWd1cmF0aW9uIGZpbGUgKGZvciBwYXJhbWV0ZXJzIGludG8gQ3JlYXRlQ2hhbmdlU2V0IGNhbGwgdGhhdFxuICAgIC8vIGNhbm5vdCBiZSBjb25maWd1cmVkIGFueSBvdGhlciB3YXkpLiBUaGV5IG11c3QgY29tZSBmcm9tIGEgZmlsZSwgYW5kIHRoZXJlJ3MgdW5mb3J0dW5hdGVseVxuICAgIC8vIG5vIGJldHRlciBob29rIHRvIHdyaXRlIHRoaXMgZmlsZSAoYGNvbnN0cnVjdC5vblN5bnRoZXNpemUoKWAgd291bGQgaGF2ZSBiZWVuIHRoZSBwcmltZSBjYW5kaWRhdGVcbiAgICAvLyBidXQgdGhhdCBpcyBiZWluZyBkZXByZWNhdGVkLS1hbmQgRGVwbG95Q2RrU3RhY2tBY3Rpb24gaXNuJ3QgZXZlbiBhIGNvbnN0cnVjdCkuXG4gICAgd3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24oYWJzQ29uZmlnUGF0aCwge1xuICAgICAgVGFnczogbm9VbmRlZmluZWQoc3RhY2sudGFncyksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVsYXRpdmVDb25maWdQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgcm9sZSBpcyB1c2VkIGJ5IGJvdGggdGhlIENvZGVQaXBlbGluZSBidWlsZCBhY3Rpb24gYW5kIHJlbGF0ZWQgQ29kZUJ1aWxkIHByb2plY3QuIENvbnNvbGlkYXRpbmcgdGhlc2UgdHdvXG4gICAqIHJvbGVzIGludG8gb25lLCBhbmQgcmUtdXNpbmcgYWNyb3NzIGFsbCBhc3NldHMsIHNhdmVzIHNpZ25pZmljYW50IHNpemUgb2YgdGhlIGZpbmFsIHN5bnRoZXNpemVkIG91dHB1dC5cbiAgICogTW9kZWxlZCBhZnRlciB0aGUgQ29kZVBpcGVsaW5lIHJvbGUgYW5kICdDb2RlUGlwZWxpbmVBY3Rpb25Sb2xlJyByb2xlcy5cbiAgICogR2VuZXJhdGVzIG9uZSByb2xlIHBlciBhc3NldCB0eXBlIHRvIHNlcGFyYXRlIGZpbGUgYW5kIERvY2tlci9pbWFnZS1iYXNlZCBwZXJtaXNzaW9ucy5cbiAgICovXG4gIHByaXZhdGUgb2J0YWluQXNzZXRDb2RlQnVpbGRSb2xlKGFzc2V0VHlwZTogQXNzZXRUeXBlKTogaWFtLklSb2xlIHtcbiAgICBpZiAodGhpcy5hc3NldENvZGVCdWlsZFJvbGVzW2Fzc2V0VHlwZV0pIHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0Q29kZUJ1aWxkUm9sZXNbYXNzZXRUeXBlXTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHRoaXMpO1xuXG4gICAgY29uc3Qgcm9sZVByZWZpeCA9IGFzc2V0VHlwZSA9PT0gQXNzZXRUeXBlLkRPQ0tFUl9JTUFHRSA/ICdEb2NrZXInIDogJ0ZpbGUnO1xuICAgIGNvbnN0IGFzc2V0Um9sZSA9IG5ldyBBc3NldFNpbmdsZXRvblJvbGUodGhpcy5hc3NldHNTY29wZSwgYCR7cm9sZVByZWZpeH1Sb2xlYCwge1xuICAgICAgcm9sZU5hbWU6IFBoeXNpY2FsTmFtZS5HRU5FUkFURV9JRl9ORUVERUQsXG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uQ29tcG9zaXRlUHJpbmNpcGFsKFxuICAgICAgICBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2NvZGVidWlsZC5hbWF6b25hd3MuY29tJyksXG4gICAgICAgIG5ldyBpYW0uQWNjb3VudFByaW5jaXBhbChzdGFjay5hY2NvdW50KSxcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICAvLyBQdWJsaXNoaW5nIHJvbGUgYWNjZXNzXG4gICAgLy8gVGhlIEFSTnMgaW5jbHVkZSByYXcgQVdTIHBzZXVkbyBwYXJhbWV0ZXJzIChlLmcuLCAke0FXUzo6UGFydGl0aW9ufSksIHdoaWNoIG5lZWQgdG8gYmUgc3Vic3RpdHV0ZWQuXG4gICAgLy8gTGF6eS1ldmFsdWF0ZWQgc28gYWxsIGFzc2V0IHB1Ymxpc2hpbmcgcm9sZXMgYXJlIGluY2x1ZGVkLlxuICAgIGFzc2V0Um9sZS5hZGRUb1BvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ3N0czpBc3N1bWVSb2xlJ10sXG4gICAgICByZXNvdXJjZXM6IExhenkubGlzdCh7IHByb2R1Y2U6ICgpID0+IEFycmF5LmZyb20odGhpcy5hc3NldFB1Ymxpc2hpbmdSb2xlc1thc3NldFR5cGVdID8/IFtdKS5tYXAoYXJuID0+IEZuLnN1Yihhcm4pKSB9KSxcbiAgICB9KSk7XG5cbiAgICAvLyBHcmFudCBwdWxsIGFjY2VzcyBmb3IgYW55IEVDUiByZWdpc3RyaWVzIGFuZCBzZWNyZXRzIHRoYXQgZXhpc3RcbiAgICBpZiAoYXNzZXRUeXBlID09PSBBc3NldFR5cGUuRE9DS0VSX0lNQUdFKSB7XG4gICAgICB0aGlzLmRvY2tlckNyZWRlbnRpYWxzLmZvckVhY2gocmVnID0+IHJlZy5ncmFudFJlYWQoYXNzZXRSb2xlLCBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORykpO1xuICAgIH1cblxuICAgIHRoaXMuYXNzZXRDb2RlQnVpbGRSb2xlc1thc3NldFR5cGVdID0gYXNzZXRSb2xlO1xuICAgIHJldHVybiBhc3NldFJvbGU7XG4gIH1cbn1cblxuZnVuY3Rpb24gZG9ja2VyVXNhZ2VGcm9tQ29kZUJ1aWxkKGNidDogQ29kZUJ1aWxkUHJvamVjdFR5cGUpOiBEb2NrZXJDcmVkZW50aWFsVXNhZ2UgfCB1bmRlZmluZWQge1xuICBzd2l0Y2ggKGNidCkge1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuQVNTRVRTOiByZXR1cm4gRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkc7XG4gICAgY2FzZSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TRUxGX01VVEFURTogcmV0dXJuIERvY2tlckNyZWRlbnRpYWxVc2FnZS5TRUxGX1VQREFURTtcbiAgICBjYXNlIENvZGVCdWlsZFByb2plY3RUeXBlLlNZTlRIOiByZXR1cm4gRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNZTlRIO1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUDogcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuXG5lbnVtIENvZGVCdWlsZFByb2plY3RUeXBlIHtcbiAgU1lOVEggPSAnU1lOVEgnLFxuICBBU1NFVFMgPSAnQVNTRVRTJyxcbiAgU0VMRl9NVVRBVEUgPSAnU0VMRl9NVVRBVEUnLFxuICBTVEVQID0gJ1NURVAnLFxufVxuXG5mdW5jdGlvbiBhY3Rpb25OYW1lPEE+KG5vZGU6IEdyYXBoTm9kZTxBPiwgcGFyZW50OiBHcmFwaE5vZGU8QT4pIHtcbiAgY29uc3QgbmFtZXMgPSBub2RlLmFuY2VzdG9yUGF0aChwYXJlbnQpLm1hcChuID0+IG4uaWQpO1xuICByZXR1cm4gbmFtZXMubWFwKHNhbml0aXplTmFtZSkuam9pbignLicpLnN1YnN0cigwLCAxMDApOyAvLyBDYW5ub3QgZXhjZWVkIDEwMCBjaGFyc1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZU5hbWUoeDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHgucmVwbGFjZSgvW15BLVphLXowLTkuQFxcLV9dL2csICdfJyk7XG59XG5cbi8qKlxuICogVGFrZSBhIHNldCBvZiB0cmFuY2hlcyBhbmQgc3BsaXQgdGhlbSB1cCBpbnRvIGdyb3VwcyBzb1xuICogdGhhdCBubyBzZXQgb2YgdHJhbmNoZXMgaGFzIG1vcmUgdGhhbiBuIGl0ZW1zIHRvdGFsXG4gKi9cbmZ1bmN0aW9uIGNodW5rVHJhbmNoZXM8QT4objogbnVtYmVyLCB4c3M6IEFbXVtdKTogQVtdW11bXSB7XG4gIGNvbnN0IHJldDogQVtdW11bXSA9IFtdO1xuXG4gIHdoaWxlICh4c3MubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHRyYW5jaGVzOiBBW11bXSA9IFtdO1xuICAgIGxldCBjb3VudCA9IDA7XG5cbiAgICB3aGlsZSAoeHNzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHhzID0geHNzWzBdO1xuICAgICAgY29uc3Qgc3BhY2VSZW1haW5pbmcgPSBuIC0gY291bnQ7XG4gICAgICBpZiAoeHMubGVuZ3RoIDw9IHNwYWNlUmVtYWluaW5nKSB7XG4gICAgICAgIHRyYW5jaGVzLnB1c2goeHMpO1xuICAgICAgICBjb3VudCArPSB4cy5sZW5ndGg7XG4gICAgICAgIHhzcy5zaGlmdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJhbmNoZXMucHVzaCh4cy5zcGxpY2UoMCwgc3BhY2VSZW1haW5pbmcpKTtcbiAgICAgICAgY291bnQgPSBuO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXQucHVzaCh0cmFuY2hlcyk7XG4gIH1cblxuXG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIGlzQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSh4OiBhbnkpOiB4IGlzIElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgcmV0dXJuICEhKHggYXMgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkpLnByb2R1Y2VBY3Rpb247XG59Il19